<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Advanced Supplier Import Wizard Views -->
    
    <record id="view_advanced_supplier_import_wizard_form" model="ir.ui.view">
        <field name="name">advanced.supplier.import.wizard.form</field>
        <field name="model">advanced.supplier.import.wizard</field>
        <field name="arch" type="xml">
            <form string="Leverancier Prijslijst Import">
                <header>
                    <!-- Progress Indicator -->
                    <div class="progress mb-3" style="height: 6px;">
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: 25%" invisible="state not in ['step1']"></div>
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: 50%" invisible="state not in ['step2']"></div>
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: 75%" invisible="state not in ['step3']"></div>
                        <div class="progress-bar bg-success" role="progressbar" 
                             style="width: 100%" invisible="state not in ['step4', 'done']"></div>
                    </div>
                    
                    <!-- Step Indicator -->
                    <div class="text-center mb-3">
                        <h1 class="mb-0">
                            <span invisible="state != 'step1'">Stap 1: Leverancier Selecteren</span>
                            <span invisible="state != 'step2'">Stap 2: CSV Uploaden</span>
                            <span invisible="state != 'step3'">Stap 3: Kolom Mapping</span>
                            <span invisible="state != 'step4'">Stap 4: Import Bevestigen</span>
                            <span invisible="state != 'done'">Import Voltooid!</span>
                        </h1>
                    </div>
                </header>

                <sheet>
                    <!-- Step 1: Supplier Selection -->
                    <group invisible="state != 'step1'">
                        <group>
                            <field name="supplier_id" options="{'no_create': True}"/>
                        </group>
                        <group>
                            <div class="alert alert-info">
                                <strong>Selecteer leverancier</strong><br/>
                                Kies de leverancier waarvoor je een prijslijst wilt importeren.
                                De module onthoudt de kolom mapping per leverancier.
                            </div>
                        </group>
                    </group>

                    <!-- Step 2: CSV Upload -->
                    <group invisible="state != 'step2'">
                        <group>
                            <field name="csv_file" filename="csv_filename"/>
                            <field name="csv_filename" invisible="1"/>
                            <field name="csv_separator"/>
                        </group>

                        <!-- CSV Headers Display -->
                        <group invisible="not csv_file" string="Gevonden CSV Kolommen">
                            <div class="alert alert-success">
                                <strong>CSV kolommen:</strong><br/>
                                <field name="csv_headers" readonly="1" nolabel="1" class="fw-bold"/>
                            </div>
                        </group>

                        <!-- CSV Preview Table -->
                        <div invisible="not csv_file" class="col-12" style="overflow-x: auto;">
                            <h5 class="mb-3">CSV Preview - Eerste 5 regels:</h5>
                            <field name="csv_preview" widget="html" nolabel="1"/>
                        </div>
                    </group>

                    <!-- Step 3: Column Mapping -->
                    <group invisible="state != 'step3'">
                        <div class="col-12">
                            <div class="alert alert-info mb-4">
                                <h5><i class="fa fa-info-circle"/> Kolom Toewijzing</h5>
                                <p class="mb-0">
                                    Koppel de CSV kolommen aan de juiste Odoo velden. 
                                    Deze mapping wordt opgeslagen voor toekomstige imports van <strong><field name="supplier_id" readonly="1" nolabel="1" class="fw-bold"/></strong>.
                                </p>
                            </div>
                            
                            <!-- Mapping Table - Simplified approach like Odoo base_import -->
                            <div class="o_import_mapping">
                                <p><strong>Column Mapping:</strong> Map CSV columns to Odoo fields</p>
                                <p class="text-muted">Available CSV columns: <field name="csv_headers" readonly="1" nolabel="1"/></p>
                                
                                <group>
                                    <group string="Basic Mapping">
                                        <field name="mapping_product_code" placeholder="CSV column for SKU/Reference"/>
                                        <field name="mapping_price" placeholder="CSV column for Price"/>
                                        <field name="mapping_min_qty" placeholder="CSV column for Min Quantity"/>
                                        <field name="mapping_delivery_time" placeholder="CSV column for Delivery Time"/>
                                    </group>
                                    <group string="Advanced Mapping">
                                        <field name="mapping_product_name" placeholder="CSV column for Product Name"/>
                                        <field name="mapping_supplier_code" placeholder="CSV column for Supplier Code"/>
                                        <field name="mapping_supplier_name" placeholder="CSV column for Supplier Name"/>
                                        <field name="mapping_currency" placeholder="CSV column for Currency"/>
                                    </group>
                                </group>
                            </div>
                            
                            <div class="alert alert-warning mt-3">
                                <strong>⚠ Belangrijk:</strong>
                                <ul class="mb-0">
                                    <li>Selecteer "-- Niet importeren --" voor kolommen die je wilt overslaan</li>
                                    <li>Voor product matching gebruik je <strong>Barcode/EAN</strong> of <strong>SKU/Referentie</strong></li>
                                    <li>Minimaal één matching veld is aanbevolen voor een succesvolle import</li>
                                </ul>
                            </div>
                        </div>
                    </group>

                    <!-- Step 4: Import Confirmation -->
                    <group invisible="state != 'step4'">
                        <div class="col-12">
                            <div class="alert alert-success">
                                <h5><i class="fa fa-check-circle"/> Klaar voor Import</h5>
                                <p><strong>Leverancier:</strong> <field name="supplier_id" readonly="1" nolabel="1"/></p>
                                <p><strong>CSV Bestand:</strong> <field name="csv_filename" readonly="1" nolabel="1"/></p>
                                <p class="mb-0"><strong>Kolom Mappings:</strong></p>
                                <ul class="list-unstyled">
                                    <li invisible="not mapping_product_code"><strong>Product Code:</strong> <field name="mapping_product_code" readonly="1" nolabel="1"/></li>
                                    <li invisible="not mapping_product_name"><strong>Product Naam:</strong> <field name="mapping_product_name" readonly="1" nolabel="1"/></li>
                                    <li invisible="not mapping_price"><strong>Prijs:</strong> <field name="mapping_price" readonly="1" nolabel="1"/></li>
                                    <li invisible="not mapping_currency"><strong>Valuta:</strong> <field name="mapping_currency" readonly="1" nolabel="1"/></li>
                                    <li invisible="not mapping_min_qty"><strong>Min. Hoeveelheid:</strong> <field name="mapping_min_qty" readonly="1" nolabel="1"/></li>
                                    <li invisible="not mapping_delivery_time"><strong>Levertijd:</strong> <field name="mapping_delivery_time" readonly="1" nolabel="1"/></li>
                                </ul>
                            </div>
                            
                            <div class="alert alert-warning">
                                <strong>⚠ Let op:</strong> 
                                Deze mapping wordt opgeslagen voor toekomstige imports van deze leverancier.
                            </div>
                        </div>
                    </group>

                    <!-- Step Done: Results -->
                    <group invisible="state != 'done'">
                        <div class="col-12">
                            <div class="alert alert-success">
                                <h5><i class="fa fa-check-circle"/> Import Voltooid!</h5>
                                <field name="import_result" readonly="1" nolabel="1"/>
                            </div>
                        </div>
                    </group>
                </sheet>

                <footer>
                    <!-- Navigation Buttons -->
                    <button string="Vorige" type="object" name="action_previous_step" 
                            class="btn-secondary" invisible="state in ['step1', 'done']"/>
                    
                    <button string="Volgende" type="object" name="action_next_step" 
                            class="btn-primary" invisible="state in ['done']"/>
                    
                    <button string="Afsluiten" special="cancel" 
                            class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Wizard Action -->
    <record id="action_advanced_supplier_import_wizard" model="ir.actions.act_window">
        <field name="name">Leverancier Prijslijst Import</field>
        <field name="res_model">advanced.supplier.import.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="view_advanced_supplier_import_wizard_form"/>
    </record>

    <!-- Mapping Templates List View -->
    <record id="view_supplier_import_mapping_tree" model="ir.ui.view">
        <field name="name">supplier.import.mapping.tree</field>
        <field name="model">supplier.import.mapping</field>
        <field name="arch" type="xml">
            <list string="Mapping Templates">
                <field name="supplier_id"/>
                <field name="csv_column"/>
                <field name="odoo_field"/>
                <field name="is_key_field"/>
                <field name="skip_empty"/>
                <field name="sequence"/>
            </list>
        </field>
    </record>

    <record id="view_supplier_import_mapping_form" model="ir.ui.view">
        <field name="name">supplier.import.mapping.form</field>
        <field name="model">supplier.import.mapping</field>
        <field name="arch" type="xml">
            <form string="Mapping Template">
                <sheet>
                    <group>
                        <field name="supplier_id"/>
                        <field name="csv_column"/>
                        <field name="odoo_field"/>
                        <field name="is_key_field"/>
                        <field name="skip_empty"/>
                        <field name="sequence"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_supplier_import_mapping_list" model="ir.actions.act_window">
        <field name="name">Mapping Templates</field>
        <field name="res_model">supplier.import.mapping</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_supplier_import_mapping_tree"/>
    </record>

</odoo>
